name: Keep Render Service Alive

on:
  schedule:
    # Ping every 14 minutes to prevent sleep
    - cron: '*/14 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render Service
        run: |
          echo "üîÑ Pinging Render service to prevent sleep..."
          
          # Replace with your actual Render URL
          RENDER_URL="${{ secrets.RENDER_SERVICE_URL || 'https://your-service-name.onrender.com' }}"
          
          echo "üì° Pinging: $RENDER_URL/ping"
          
          # Ping with timeout and retry
          for i in {1..3}; do
            if curl -f -m 30 "$RENDER_URL/ping"; then
              echo "‚úÖ Ping successful on attempt $i"
              exit 0
            else
              echo "‚ùå Ping failed on attempt $i"
              sleep 10
            fi
          done
          
          echo "üö® All ping attempts failed"
          exit 1

      - name: Check Health Endpoint
        run: |
          RENDER_URL="${{ secrets.RENDER_SERVICE_URL || 'https://your-service-name.onrender.com' }}"
          
          echo "üè• Checking health endpoint..."
          response=$(curl -s "$RENDER_URL/health" || echo "failed")
          
          if [[ "$response" == "failed" ]]; then
            echo "‚ùå Health check failed"
          else
            echo "‚úÖ Health check response:"
            echo "$response" | jq . || echo "$response"
          fi