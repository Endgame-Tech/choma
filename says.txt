 WARN  Orders state is not an array, resetting to empty array
 LOG  API Request (Attempt 1): GET http://172.23.187.104:5001/api/orders
 LOG  API Request (Attempt 1): GET http://172.23.187.104:5001/api/notifications?_t=1761838216647
 LOG  üìã Cache SET: userOrders (60 bytes)
 LOG  üìä Order deduplication: 2 ‚Üí 2 orders
 LOG  üîç Rendering order: {"activationCompleted": false, "dayNumber": 1, "deliveryDay": 1, "hasRecurringOrder": true, "hasSubscriptionField
": true, "id": "176183D01", "isActivationOrder": false, "isSubscriptionOrder": undefined, "orderNumber": "SUB-1761835366416-6555", "orderTy
pe": undefined, "recurringOrder": {"activationCompleted": false, "isActivationOrder": false, "orderType": "subscription-recurring", "parentSubscription": "69037959504a5ddf5f23767f"}, "recurringOrderType": "subscription-recurring", "status": "ready", "subscription": true}       
 LOG  üìä Order analysis: {"cardType": "CompactOrderCard", "isFirstDelivery": true, "isSubscriptionOrder": true, "reasoning": {"activationCompleted": false, "hasRecurringOrder": true, "hasSubscription": false, "isActivationOrder": false, "orderType": "subscription-recurring"}}  
 LOG  üîç Rendering order: {"activationCompleted": false, "dayNumber": 2, "deliveryDay": 2, "hasRecurringOrder": true, "hasSubscriptionField
": true, "id": "176183D02", "isActivationOrder": false, "isSubscriptionOrder": undefined, "orderNumber": "SUB-1761835366416-6555", "orderTy
pe": undefined, "recurringOrder": {"activationCompleted": false, "isActivationOrder": false, "orderType": "subscription-recurring", "parentSubscription": "69037959504a5ddf5f23767f"}, "recurringOrderType": "subscription-recurring", "status": "pending", "subscription": true}     
 LOG  üìä Order analysis: {"cardType": "CompactOrderCard", "isFirstDelivery": true, "isSubscriptionOrder": true, "reasoning": {"activationCompleted": false, "hasRecurringOrder": true, "hasSubscription": false, "isActivationOrder": false, "orderType": "subscription-recurring"}}  
 LOG  üñºÔ∏è Getting meal plan image for order: {"mealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-pl
a                                                                                                                                         a
ns/e8jr54vhgoewlarhalqc.jpg", "orderId": "176183D01", "orderImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/me
al-plans/e8jr54vhgoewlarhalqc.jpg", "orderItemsImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr
54vhgoewlarhalqc.jpg", "subscriptionMealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54v
hgoewlarhalqc.jpg", "subscriptionPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg"}
 LOG  ‚úÖ Using subscription.planImage
 LOG  üñºÔ∏è Getting meal plan image for order: {"mealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-pl
a                                                                                                                                         a
ns/e8jr54vhgoewlarhalqc.jpg", "orderId": "176183D02", "orderImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/me
al-plans/e8jr54vhgoewlarhalqc.jpg", "orderItemsImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr
54vhgoewlarhalqc.jpg", "subscriptionMealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54v
hgoewlarhalqc.jpg", "subscriptionPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg"}
 LOG  ‚úÖ Using subscription.planImage
 LOG  üìã Cache SET: userOrders (157603 bytes)
 LOG  üìã Orders data cached for faster future access
 LOG  ‚úÖ Loaded 2 total orders (2 active)
 LOG  üîÑ CompactOrderCard - Day 1 (176183D01): {"daySpecificStatus": undefined, "delegationStatus": "ready", "fullOrder": {"__v": 0, "_id":
 "176183D01", "adminNotes": "Subscription order covering 2 delivery dates", "assignedChef": {"_id": "68c0c952d31fbb0fb313f0a8", "email": "l
egendetestimony@gmail.com", "fullName": "Legend Testimony"}, "assignedDriver": {"_id": "68c0ca6fd31fbb0fb313f125", "fullName": "Legend Test
imony", "phone": "08139120289"}, "chefAcceptedDate": "2025-10-30T14:53:59.781Z", "confirmationCode": "4606", "createdDate": "2025-10-30T14:
42:33.554Z", "customer": {"_id": "69036e41504a5ddf5f237351", "email": "legendetestimony@gmail.com", "fullName": "Legend Testimony Ebere", "
phone": "+19048917537"}, "dailyTimeline": [[Object], [Object]], "dayNumber": 1, "delegationStatus": "ready", "deliveryAddress": "Heathrow A
irport, Greater London, England, United Kingdom", "deliveryDate": "2025-10-30T00:00:00.000Z", "deliveryDay": 1, "deliveryNotes": "Subscript
ion order - 2 deliveries", "driverAssignment": {"_id": "69037c36cf8382ed4a1d5347", "confirmationCode": "4606", "deliveryLocation": [Object]
, "driver": [Object], "estimatedDeliveryTime": "2025-10-30T15:39:46.952Z", "estimatedPickupTime": "2025-10-30T15:09:46.952Z", "pickupLocati
on": [Object], "status": "picked_up"}, "estimatedDelivery": "2025-10-30T00:00:00.000Z", "image": "https://res.cloudinary.com/dql0tbyes/imag
e/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "instructions": "Delivery 1 of 2 - 30/10/2025", "mealPlan": {"coverImage":
 "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "image": "https://res.cloudinar
y.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "name": "FitFam Fuel c - Day 1", "planImageUrl": "http
s://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg"}, "orderItems": {"image": "https://res
.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "meals": [Array], "planName": "FitFam Fuel c
 - Day 1"}, "orderNumber": "SUB-1761835366416-6555", "orderStatus": "Out for Delivery", "paymentMethod": "Card", "paymentStatus": "Paid", "
priority": "Medium", "recurringOrder": {"activationCompleted": false, "isActivationOrder": false, "orderType": "subscription-recurring", "p
arentSubscription": "69037959504a5ddf5f23767f"}, "specialInstructions": "", "status": "ready", "subDayId": "176183D01", "subscription": {"_
_v": 0, "_id": "69037959504a5ddf5f23767f", "adminNotes": [Array], "allergens": [Array], "autoRenewal": false, "basePlanPrice": 21880, "crea
tedAt": "2025-10-30T14:42:33.245Z", "createdDate": "2025-10-30T14:42:33.226Z", "customerId": "69036e41504a5ddf5f237351", "customization": [
Object], "deliveryAddress": "Heathrow Airport, Greater London, England, United Kingdom", "deliveryPreferences": [Object], "dietaryPreferenc
es": [Array], "duration": "1", "durationMultiplier": 1, "durationWeeks": 1, "endDate": "2025-11-06T14:42:17.959Z", "feedback": [Array], "fi
rstDeliveryCompleted": false, "frequency": "all", "frequencyMultiplier": 1, "mealPlan": [Object], "mealPlanId": [Object], "mealPlanSnapshot
": [Object], "metrics": [Object], "nextDelivery": "2025-10-31T14:42:17.959Z", "notificationSettings": [Object], "paymentMethod": "paystack"
, "paymentReference": "choma-1761835366416-905138", "paymentStatus": "Paid", "planImage": "https://res.cloudinary.com/dql0tbyes/image/uploa
d/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "portionSize": "medium", "price": 25275, "recurringDelivery": [Object], "renewalN
otificationSent": false, "renewalType": "monthly", "selectedMealTypes": [Array], "skippedDeliveries": [Array], "specialInstructions": "", "
spiceLevel": "medium", "startDate": "2025-10-30T14:42:17.959Z", "status": "Active", "subscriptionId": "SUB-1761835366416-6555", "totalPrice
": 25275, "transactionId": "TXN-1761835352977-FFWZZE", "updatedAt": "2025-10-30T14:54:08.463Z", "userId": "69036e41504a5ddf5f237351"}, "tim
elineId": "TL-SUB-1761835366416-6555-1", "totalAmount": 21880, "updatedDate": "2025-10-30T15:24:57.856Z"}, "orderStatus": "ready", "rawOrderStatus": "Out for Delivery", "rawStatus": "ready"}
 LOG  üìç Status mapping for Day 1 (176183D01): {"expectedStep": 2, "mappedStep": 2, "normalizedStatus": "ready", "rawFinalStatus": "ready"}
 LOG  üîÑ CompactOrderCard - Day 2 (176183D02): {"daySpecificStatus": undefined, "delegationStatus": "pending", "fullOrder": {"__v": 0, "_id
": "176183D02", "adminNotes": "Subscription order covering 2 delivery dates", "assignedChef": {"_id": "68c0c952d31fbb0fb313f0a8", "email": 
"legendetestimony@gmail.com", "fullName": "Legend Testimony"}, "assignedDriver": {"_id": "68c0ca6fd31fbb0fb313f125", "fullName": "Legend Te
stimony", "phone": "08139120289"}, "chefAcceptedDate": "2025-10-30T14:53:59.781Z", "confirmationCode": "4606", "createdDate": "2025-10-30T1
4:42:33.554Z", "customer": {"_id": "69036e41504a5ddf5f237351", "email": "legendetestimony@gmail.com", "fullName": "Legend Testimony Ebere",
 "phone": "+19048917537"}, "dailyTimeline": [[Object], [Object]], "dayNumber": 2, "delegationStatus": "pending", "deliveryAddress": "Heathr
ow Airport, Greater London, England, United Kingdom", "deliveryDate": "2025-10-31T00:00:00.000Z", "deliveryDay": 2, "deliveryNotes": "Subsc
ription order - 2 deliveries", "driverAssignment": {"_id": "69037c36cf8382ed4a1d5347", "confirmationCode": "4606", "deliveryLocation": [Obj
ect], "driver": [Object], "estimatedDeliveryTime": "2025-10-30T15:39:46.952Z", "estimatedPickupTime": "2025-10-30T15:09:46.952Z", "pickupLo
cation": [Object], "status": "picked_up"}, "estimatedDelivery": "2025-10-31T00:00:00.000Z", "image": "https://res.cloudinary.com/dql0tbyes/
image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "instructions": "Delivery 2 of 2 - 31/10/2025", "mealPlan": {"coverIma
ge": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "image": "https://res.cloud
inary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "name": "FitFam Fuel c - Day 2", "planImageUrl": "
https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg"}, "orderItems": {"image": "https:/
/res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "meals": [Array], "planName": "FitFam Fu
el c - Day 2"}, "orderNumber": "SUB-1761835366416-6555", "orderStatus": "Out for Delivery", "paymentMethod": "Card", "paymentStatus": "Paid
", "priority": "Medium", "recurringOrder": {"activationCompleted": false, "isActivationOrder": false, "orderType": "subscription-recurring"
, "parentSubscription": "69037959504a5ddf5f23767f"}, "specialInstructions": "", "status": "pending", "subDayId": "176183D02", "subscription
": {"__v": 0, "_id": "69037959504a5ddf5f23767f", "adminNotes": [Array], "allergens": [Array], "autoRenewal": false, "basePlanPrice": 21880,
 "createdAt": "2025-10-30T14:42:33.245Z", "createdDate": "2025-10-30T14:42:33.226Z", "customerId": "69036e41504a5ddf5f237351", "customizati
on": [Object], "deliveryAddress": "Heathrow Airport, Greater London, England, United Kingdom", "deliveryPreferences": [Object], "dietaryPre
ferences": [Array], "duration": "1", "durationMultiplier": 1, "durationWeeks": 1, "endDate": "2025-11-06T14:42:17.959Z", "feedback": [Array
], "firstDeliveryCompleted": false, "frequency": "all", "frequencyMultiplier": 1, "mealPlan": [Object], "mealPlanId": [Object], "mealPlanSn
apshot": [Object], "metrics": [Object], "nextDelivery": "2025-10-31T14:42:17.959Z", "notificationSettings": [Object], "paymentMethod": "pay
stack", "paymentReference": "choma-1761835366416-905138", "paymentStatus": "Paid", "planImage": "https://res.cloudinary.com/dql0tbyes/image
/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg", "portionSize": "medium", "price": 25275, "recurringDelivery": [Object], "re
newalNotificationSent": false, "renewalType": "monthly", "selectedMealTypes": [Array], "skippedDeliveries": [Array], "specialInstructions":
 "", "spiceLevel": "medium", "startDate": "2025-10-30T14:42:17.959Z", "status": "Active", "subscriptionId": "SUB-1761835366416-6555", "tota
lPrice": 25275, "transactionId": "TXN-1761835352977-FFWZZE", "updatedAt": "2025-10-30T14:54:08.463Z", "userId": "69036e41504a5ddf5f237351"}
, "timelineId": "TL-SUB-1761835366416-6555-2", "totalAmount": 21880, "updatedDate": "2025-10-30T15:24:57.856Z"}, "orderStatus": "pending", "rawOrderStatus": "Out for Delivery", "rawStatus": "pending"}
 LOG  üìç Status mapping for Day 2 (176183D02): {"expectedStep": 0, "mappedStep": 0, "normalizedStatus": "pending", "rawFinalStatus": "pending"}
 LOG  üîÑ Starting optimized order status updates...
 LOG  üîç Rendering order: {"activationCompleted": false, "dayNumber": 1, "deliveryDay": 1, "hasRecurringOrder": true, "hasSubscriptionField
": true, "id": "176183D01", "isActivationOrder": false, "isSubscriptionOrder": undefined, "orderNumber": "SUB-1761835366416-6555", "orderTy
pe": undefined, "recurringOrder": {"activationCompleted": false, "isActivationOrder": false, "orderType": "subscription-recurring", "parentSubscription": "69037959504a5ddf5f23767f"}, "recurringOrderType": "subscription-recurring", "status": "ready", "subscription": true}       
 LOG  üìä Order analysis: {"cardType": "CompactOrderCard", "isFirstDelivery": true, "isSubscriptionOrder": true, "reasoning": {"activationCompleted": false, "hasRecurringOrder": true, "hasSubscription": false, "isActivationOrder": false, "orderType": "subscription-recurring"}}  
 LOG  üîç Rendering order: {"activationCompleted": false, "dayNumber": 2, "deliveryDay": 2, "hasRecurringOrder": true, "hasSubscriptionField
": true, "id": "176183D02", "isActivationOrder": false, "isSubscriptionOrder": undefined, "orderNumber": "SUB-1761835366416-6555", "orderTy
pe": undefined, "recurringOrder": {"activationCompleted": false, "isActivationOrder": false, "orderType": "subscription-recurring", "parentSubscription": "69037959504a5ddf5f23767f"}, "recurringOrderType": "subscription-recurring", "status": "pending", "subscription": true}     
 LOG  üìä Order analysis: {"cardType": "CompactOrderCard", "isFirstDelivery": true, "isSubscriptionOrder": true, "reasoning": {"activationCompleted": false, "hasRecurringOrder": true, "hasSubscription": false, "isActivationOrder": false, "orderType": "subscription-recurring"}}  
 LOG  üñºÔ∏è Getting meal plan image for order: {"mealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-pl
a                                                                                                                                         a
ns/e8jr54vhgoewlarhalqc.jpg", "orderId": "176183D01", "orderImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/me
al-plans/e8jr54vhgoewlarhalqc.jpg", "orderItemsImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr
54vhgoewlarhalqc.jpg", "subscriptionMealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54v
hgoewlarhalqc.jpg", "subscriptionPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg"}
 LOG  ‚úÖ Using subscription.planImage
 LOG  üñºÔ∏è Getting meal plan image for order: {"mealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-pl
a                                                                                                                                         a
ns/e8jr54vhgoewlarhalqc.jpg", "orderId": "176183D02", "orderImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/me
al-plans/e8jr54vhgoewlarhalqc.jpg", "orderItemsImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr
54vhgoewlarhalqc.jpg", "subscriptionMealPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54v
hgoewlarhalqc.jpg", "subscriptionPlanImage": "https://res.cloudinary.com/dql0tbyes/image/upload/v1758034468/choma/meal-plans/e8jr54vhgoewlarhalqc.jpg"}
 LOG  ‚úÖ Using subscription.planImage
 LOG  ‚ÑπÔ∏è Raw API response structure: {
  "success": true,
  "data": {
    "success": true,
    "data": {
      "notifications": [
        {
          "_id": "69037c37cf8382ed4a1d5350",
          "userId": "69036e41504a5ddf5f237351",
          "title": "Driver Assigned",
          "message": "üöö Your order is now out for delivery! Driver Legend Testimony is on the way to deliver your delicious meals.",      
          "type": "driver_assignment",
          "isRead": false,
          "data": {
            "orderId": "69037959504a5ddf5f237692",
            "driverId": "68c0ca6fd31fbb0fb313f125",
            "driverName": "Legend Testimony",
            "vehicleInfo": {
              "type": "motorcycle",
              "model": "Lexus 3350",
              "plateNumber": "ABC-123DE",
              "capacity": 10
            }
          },
          "priority": "high",
          "pushSent": true,
          "expiresAt": "2025-11-29T14:54:47.257Z",
          "createdAt": "2025-10-30T14:54:47.258Z",
          "updatedAt": "2025-10-30T14:54:47.773Z",
          "__v": 0,
          "pushSentAt": "2025-10-30T14:54:47.772Z"
        },
        {
          "_id": "69037965504a5ddf5f2376d8",
          "userId": "69036e41504a5ddf5f237351",
          "title": "Payment Successful! üí≥",
          "message": "Your payment of ‚Ç¶25275 has been processed successfully.",
          "type": "payment_success",
          "isRead": true,
          "data": {
            "amount": 25275,
            "reference": "choma-1761835366416-905138",
            "subscriptionId": "69037959504a5ddf5f23767f"
          },
          "priority": "high",
          "pushSent": true,
          "expiresAt": "2025-11-29T14:42:45.287Z",
          "createdAt": "2025-10-30T14:42:45.288Z",
          "updatedAt": "2025-10-30T14:42:55.233Z",
          "__v": 0,
          "pushSentAt": "2025-10-30T14:42:45.445Z"
        },
        {
          "_id": "69037964504a5ddf5f2376d0",
          "userId": "69036e41504a5ddf5f237351",
          "title": "Subscription Activated! ‚úÖ",
          "message": "Your FitFam Fuel c subscription is now active. Your meals start on Fri Oct 31 2025 14:42:17 GMT+0000 (Greenwich Mean Time).",
          "type": "subscription_created",
          "isRead": false,
          "data": {
            "planName": "FitFam Fuel c",
            "startDate": "2025-10-31T14:42:17.959Z",
            "frequency": "all",
            "duration": "1"
          },
          "priority": "high",
          "pushSent": true,
          "expiresAt": "2025-11-29T14:42:44.756Z",
          "createdAt": "2025-10-30T14:42:44.756Z",
          "updatedAt": "2025-10-30T14:42:44.914Z",
          "__v": 0,
          "pushSentAt": "2025-10-30T14:42:44.914Z"
        },
        {
          "_id": "69037963504a5ddf5f2376cb",
          "userId": "69036e41504a5ddf5f237351",
          "title": "Order Confirmed! üì¶",
          "message": "Order #SUB-1761835366416-6555 has been confirmed and is being prepared by our chef.",
          "type": "order_confirmed",
          "isRead": false,
          "data": {
            "orderNumber": "SUB-1761835366416-6555",
            "planName": "FitFam Fuel c",
            "deliveryDate": "2025-10-31T14:42:17.959Z",
            "totalAmount": 21880
          },
          "priority": "high",
          "pushSent": true,
          "expiresAt": "2025-11-29T14:42:43.800Z",
          "createdAt": "2025-10-30T14:42:43.801Z",
          "updatedAt": "2025-10-30T14:42:44.684Z",
          "__v": 0,
          "pushSentAt": "2025-10-30T14:42:44.683Z"
        }
      ],
      "pagination": {
        "currentPage": 1,
        "totalPages": 1,
        "totalNotifications": 4,
        "hasNext": false,
        "hasPrev": false,
        "unreadCount": 3
      }
    }
  }
}